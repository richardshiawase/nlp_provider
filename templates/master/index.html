{% extends 'base.html' %}
{% block title %} Master {% endblock %}

{% block content %}
<div class="container">
        <div class="row mt-3">
            <div class="col-sm-3">
                <button type="button" id="btn_tambah_master" class="btn btn-primary" >
                  Tambah Master
                </button>

            </div>

        </div>

        <div class="row mt-3">

            <table id="albumse" class="table table-striped table-bordered" style="width:100%">
                <thead>
                <tr>
<!--                    <th></th>-->
                    <th style="width:2%" data-data="rank">Provider ID</th>
                    <th style="width:20%" data-data="rank">Nama</th>
                    <th style="width:30%" data-data="rank">Alamat</th>
                    <th style="width:2%" data-data="rank">Kategori</th>
                    <th style="width:10%" data-data="rank">Phone</th>
                    <th style="width:10%" data-data="rank">Edit</th>
                    <th style="width:10%" data-data="rank">Delete</th>



                </tr>
                </thead>
            </table>
        </div>

</div>


<script>



      $(document).ready(function() {

            $('#btn_tambah_master').click(function(){
              var url = "master-add";
               window.open(url);
              return false;
            });


         var table =     $('#albumse').DataTable({
              ajax: {
              url: "{% url 'master_liste' %}",
              type: 'GET',
              dataSrc: "",
          },


           columnDefs: [

                    {

                         "render" : function(data,type,row){
                          return '<button id="proses_master" type="button" class="btn btn-primary">Proses Master</button>'
                        },
                        targets : 5

                    },

                    {

                         "render" : function(data,type,row){
                          return '<button id="delete_master" type="button" class="btn btn-danger">Delete Master</button>'
                        },
                        targets : 6

                    },

                   {
                    "render" : function(data,type,row){
                        switch(data){
                            case "1":
                                return "Rumah Sakit";
                                break;
                            case "2":
                                return "Klinik";
                                break;
                            case "3":
                                return "Apotek";
                            case "4":
                                return "Lab";
                            case "5":
                                return "Praktek";
                            case "6":
                                return "Optik";
                            default :
                                return data;

                        }
                    },
                    targets : 3
                  }
              ],

          columns: [

                  {   data: "provider_id" },
                  {   data: "nama_provider" },
                  {   data: "address" },
                  {   data: "category_1" },
                  {   data: "tel_no" },



              ],
          });


           $('#albumse tbody').on('click', '#proses_master', function () {
            var data = table.row($(this).parents('tr')).data();
            var temporer_url = "{% url "ajax_temporer_master" %}";
            $.ajax(
                {
                    dataType: 'json',
                    method:"POST",
                    url: temporer_url,
                    data:
                    {
                        "processed_file":JSON.stringify(data),
                        "csrfmiddlewaretoken":$( "input[name='csrfmiddlewaretoken']" ).val()
                    },
                    success: function( data )
                    {
                        if (data.data == 200)
                        {
                             window.location.href = '{% url "edit_master" %}';
                        }
                    }
                 })
                 return false;
        });



        $('#albumse tbody').on('click', '#delete_master', function () {
            var data = table.row($(this).parents('tr')).data();
            console.log(data);
            var temporer_url = "{% url "ajax_delete_master" %}";
            $.ajax(
                {
                    dataType: 'json',
                    method:"POST",
                    url: temporer_url,
                    data:
                    {
                        "processed_file":JSON.stringify(data),
                        "csrfmiddlewaretoken":$( "input[name='csrfmiddlewaretoken']" ).val()
                    },
                    success: function( data )
                    {
                        if (data.data == 200)
                        {
                            console.log("Hapus berhasil");
                        }else{
                            console.log("Hapus gagal");
                        }
                    }
                 })
                 return false;
        });



      });
</script>

{% endblock %}